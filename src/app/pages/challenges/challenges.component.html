<!-- Tournament Banner -->
<ng-container *ngIf="activeTournament$ | async as tournament">
  <div class="tournament-banner">
    <h2>‚öîÔ∏è {{ 'challenges.live_tournament' | translate }}: {{ tournament.name }}</h2>
    <p>{{ tournament.description }}</p>
    <button [routerLink]="['/tournaments', tournament.id]" class="tournament-button">
      {{ 'challenges.join_now' | translate }}
    </button>
  </div>
</ng-container>

<!-- View Controls -->
<div class="controls">
  <div class="difficulty-filter">
    <select [(ngModel)]="selectedDifficulty">
      <option value="all">{{ 'challenges.all_difficulties' | translate }}</option>
      <option *ngFor="let level of difficultyLevels" [value]="level">
        {{ 'challenges.' + level | translate }}
      </option>
    </select>
  </div>

  <button (click)="toggleViewMode()" class="view-toggle">
    {{ isListView ? '‚ò∑ Grid' : '‚ò∞ List' }}
  </button>
</div>

<!-- Challenges Display -->
<div [class.list-view]="isListView" class="challenges-container">
  <ng-container *ngIf="filteredChallenges$ | async as challenges">
    <div *ngFor="let challenge of challenges" class="challenge-card" [class.active]="challenge.isActive" (click)="launchChallenge(challenge)">
      <div class="card-header">
        <h3>{{ challenge.title }}</h3>
        <span class="difficulty" [class]="challenge.difficulty">
          {{ 'challenges.' + challenge.difficulty | translate }}
        </span>
      </div>

      <p>{{ challenge.description }}</p>

      <div class="card-footer">
        <span class="category">#{{ challenge.category }}</span>
        <span class="points">üèÜ {{ challenge.points }} {{ 'challenges.points' | translate }}</span>
      </div>
    </div>
  </ng-container>
</div>

<!-- VM Container -->
<div class="vm-container" *ngIf="activeChallenge">
  <div class="vm-toolbar">
    <button (click)="closeVM()">‚Üê {{ 'challenges.back_to_challenges' | translate }}</button>
    <h3>{{ 'challenges.testing' | translate }}: {{ activeChallenge.title }}</h3>
  </div>

  <ng-container *ngIf="activeChallenge.vmUrl; else noVm">
    <iframe [src]="safeUrl(activeChallenge.vmUrl)" sandbox="allow-scripts allow-same-origin" class="vm-frame"> </iframe>
  </ng-container>

  <ng-template #noVm>
    <div class="no-vm-message">
      <p>‚ö†Ô∏è Virtual machine not available for this challenge</p>
      <button routerLink="/challenges/{{ activeChallenge.id }}/simulator">Try our simulator instead</button>
    </div>
  </ng-template>
</div>
